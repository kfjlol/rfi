// CSS3MultiColumn - a javascript implementation of the CSS3 multi-column module
// v1.02 beta - Jan 08 2008
// Copyright (c) 2005 Cdric Savarese <pro@4213miles.com>
// This software is licensed under the CC-GNU LGPL <http://creativecommons.org/licenses/LGPL/2.1/>
// For additional information, see : http://www.csscripting.com/
// Supported Properties: 
// column-count, column-width, column-gap, column-rule
;(function(){function CSS3Utility(){this.handlerList=new Array}function CSS3MultiColumn(){function getElementRelativeTop(a,b){var c=0;if(a.offsetParent){while(a.offsetParent){c+=a.offsetTop;a=a.offsetParent}}var d=0;if(b.offsetParent){while(b.offsetParent){d+=b.offsetTop;b=b.offsetParent}}return c-d}function moveNode(a,b,c){var d=createNodeAncestors(a,b,c,"append");var e=d.appendChild(a.parentNode.removeChild(a));if(d.id==c.id&&e.nodeType==1){e.style.paddingTop="0px";e.style.marginTop="0px"}return e}function createNodeAncestors(a,b,c,d){var e=new Array;var f=c;var g=a.parentNode;while(g&&g.id!=b.id){e[e.length]=g;if(!g.id)g.id=ut.randomId();g=g.parentNode}for(var h=e.length-1;h>=0;h--){for(var i=0;i<f.childNodes.length&&(f.childNodes[i].nodeType==3||!f.childNodes[i].className.match(e[h].id+"-css3mc"));i++);if(i==f.childNodes.length){if(d=="append")f=f.appendChild(document.createElement(e[h].tagName));else f=f.insertBefore(document.createElement(e[h].tagName),f.firstChild);f.className=e[h].className+" "+e[h].id+"-css3mc";f.style.marginTop="0";f.style.paddingTop="0";if(f.tagName.toUpperCase()=="OL"&&a.nodeType==1&&a.tagName.toUpperCase()=="LI"){var j=a.previousSibling;var k=0;while(j){if(j.nodeType==1&&j.tagName.toUpperCase()=="LI")k++;j=j.previousSibling}f.setAttribute("start",k)}}else{f=f.childNodes[i];if(f.tagName.toUpperCase()=="OL"&&(f.start==-1||f.start==1)&&a.nodeType==1&&a.tagName.toUpperCase()=="LI"){var j=a.previousSibling;var k=0;while(j){if(j.nodeType==1&&j.tagName.toUpperCase()=="LI")k++;j=j.previousSibling}f.setAttribute("start",k)}}}return f}function stripOneLine(a){while(a&&a.nodeType!=3)a=a.firstChild;if(!a)return;var b=a.parentNode;var c=b.offsetHeight;if(!c){return""}var d=a.nodeValue;var e=a.nodeValue.lastIndexOf(" ");while(e!=-1&&b.offsetHeight==c){a.nodeValue=a.nodeValue.substr(0,e);e=a.nodeValue.lastIndexOf(" ");if(e==-1)e=a.nodeValue.lastIndexOf("\n")}if(b.offsetHeight==c)a.nodeValue="";return d.substr(a.nodeValue.length)}function splitElement(a,b,c,d){var e=a.lastChild;while(e){if(e.nodeType==3){var f="dummmy";var g="";while(a.offsetHeight>b+2&&f!=""){f=stripOneLine(e);g=f+g}if(g!=""){var h=createNodeAncestors(e,c,d,"insertBefore");h.insertBefore(document.createTextNode(g),h.firstChild)}if(e.nodeValue==""){e.parentNode.removeChild(e)}else break}else{var h=createNodeAncestors(e,c,d,"insertBefore");h.insertBefore(e.parentNode.removeChild(e),h.firstChild)}e=a.lastChild}return f}function isElementSplitable(a){if(a.tagName){var b=a.tagName.toUpperCase();for(var c=0;c<splitableTags.length;c++)if(b==splitableTags[c])return true}return false}function findSplitPoint(a,b,c){if(a.nodeType==1){var d=getElementRelativeTop(a,c);var e=d+a.offsetHeight;if(d<b&&e>b){bestSplitPoint=a;if(isElementSplitable(a)){for(var f=0;f<a.childNodes.length;f++){findSplitPoint(a.childNodes[f],b,c)}}return}if(e<=b&&e>=secondSplitBottom){secondSplitBottom=e;secondSplitPoint=a}}return}function processElement(a,b,c,d,e){var f;var g;var h=0;if(a.clientWidth&&a.clientWidth!=0){var i;if(a.currentStyle){i=parseInt(a.currentStyle.paddingLeft.replace(/[\D]*/gi,""))+parseInt(a.currentStyle.paddingRight.replace(/[\D]*/gi,""))}else if(document.defaultView&&document.defaultView.getComputedStyle){i=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-left").replace(/[\D]*/gi,""))+parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-left").replace(/[\D]*/gi,""))}if(isNaN(i))i=0;g=(a.clientWidth-i).toString()+"px"}else if(a.scrollWidth){var j;var i;if(a.currentStyle){i=parseInt(a.currentStyle.paddingLeft.replace(/[\D]*/gi,""))+parseInt(a.currentStyle.paddingRight.replace(/[\D]*/gi,""))}else if(document.defaultView&&document.defaultView.getComputedStyle){i=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-left").replace(/[\D]*/gi,""))+parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-left").replace(/[\D]*/gi,""))}if(isNaN(i))i=0;if(a.currentStyle){j=parseInt(a.currentStyle.borderLeftWidth.replace(/[\D]*/gi,""))+parseInt(a.currentStyle.borderRightWidth.replace(/[\D]*/gi,""))}else if(document.defaultView&&document.defaultView.getComputedStyle){j=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("border-left-width").replace(/[\D]*/gi,""))+parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("border-right-width").replace(/[\D]*/gi,""))}if(isNaN(j))j=0;g=(a.scrollWidth-i-j).toString()+"px"}else g="99%";var k=parseInt(g.replace(/[\D]*/gi,""));if(!c||c=="auto")f=g.replace(/[\d]*/gi,"");else f=c.replace(/[\d]*/gi,"");if(!f)f="px";if(!d){if(f=="%")d=1;else d=15}else{d=parseInt(d.replace(/[\D]*/gi,""))}if(e&&e!="none"){d=Math.floor(d/2);h=d+parseInt(e.substring(e.search(/\d/),e.search(/\D/)))}if(!c||c=="auto"){c=(k-(d+h)*(b-1))/b}else{c=parseInt(c.replace(/[\D]*/gi,""));if(!b||b=="auto"){b=Math.floor(k/(c+d))}}c-=1;var l=document.createElement("div");var m=a.parentNode;l=m.insertBefore(l,a);var n=m.removeChild(a);n=l.appendChild(n);l.className=n.className;n.className="";n.id=ut.randomId();n.style.width=c.toString()+f;if(typeof n.style.styleFloat!="undefined")n.style.styleFloat="left";if(typeof n.style.cssFloat!="undefined")n.style.cssFloat="left";var o=Math.floor(n.offsetHeight/b)+14;if(!l.id)l.id=ut.randomId();var p=1;for(var q=1;q<b&&n&&p<b+5;q++){bestSplitPoint=null;secondSplitPoint=null;secondSplitBottom=0;findSplitPoint(n,o*q,l);if(isDebug)bestSplitPoint.style.border="1px solid #00FF00";if(bestSplitPoint&&!isElementSplitable(bestSplitPoint)){o=getElementRelativeTop(bestSplitPoint,l)+bestSplitPoint.offsetHeight+10;q=1;debug("reset new Height = "+o+" relativetop="+getElementRelativeTop(bestSplitPoint,l)+" offsetHeight= "+bestSplitPoint.offsetHeight)}else if(!bestSplitPoint){debug("No split point found with "+o)}p++}debug("<table><tr><td>Avail. Width</td><td>"+k+"</td><td>Units</td><td>"+f+"</td></tr><tr><td>column_width</td><td>"+c+"</td><td>column_count</td><td>"+b+"</td></tr><tr><td>column_gap</td><td>"+d+"</td><td>column_rule</td><td>"+e+"</td></tr><tr><td>New Height</td><td>"+o+"</td><td></td><td></td></tr></table>");for(var q=1;q<b&&n;q++){bestSplitPoint=null;secondSplitPoint=null;secondSplitBottom=0;findSplitPoint(n,o,l);if(bestSplitPoint&&isElementSplitable(bestSplitPoint)&&n.id!=bestSplitPoint.id){var r=bestSplitPoint;if(isDebug)secondSplitPoint.style.border="1px dotted #00F"}else{var r=secondSplitPoint}if(!r){debug("<hr />No split point found for "+n.tagName+" "+o);return}if(isDebug)r.style.border="1px solid #F00";var s=n.cloneNode(false);s.id=ut.randomId();n.parentNode.insertBefore(s,n.nextSibling);s.style.paddingLeft=d+f;if(e&&e!="none"){s.style.borderLeft=e;n.style.paddingRight=d+f}if(document.all&&!window.opera)n.style.height=o+"px";n.style.minHeight=o+"px";var t=createNodeAncestors(r,n,s,"append");var u=r;while(u&&u.id!=n.id){var v=u.nextSibling;while(v){moveNode(v,n,s);v=u.nextSibling}u=u.parentNode}var w=splitElement(r,o-getElementRelativeTop(r,l),n,s);var m=r.parentNode;while(m&&m.id!=n.id){var x=m.firstChild;while(x){if(x.nodeType==1&&x.childNodes.length==0||x.nodeType==3&&x.nodeValue.replace(/[\u0020\u0009\u000A]*/,"")==""){m.removeChild(x);x=m.firstChild}else{x=x.nextSibling}}m=m.parentNode}if(w){r=n.lastChild;if(r&&document.defaultView&&document.defaultView.getComputedStyle(r,"").getPropertyValue("text-align")=="justify"||r.currentStyle&&r.currentStyle.textAlign=="justify"){var y=document.createTextNode(" "+w.replace(/./g,"Â "));var z=document.createElement("span");r.appendChild(z);z.style.lineHeight="1px";z.appendChild(y)}}n=s}if(n){if(document.all&&!window.opera)n.style.height=o+"px";n.style.minHeight=o+"px"}var A=document.createElement("div");A.style.clear="left";A.appendChild(document.createTextNode(" "));l.appendChild(A);if(navigator.userAgent.toLowerCase().indexOf("safari")+1)l.innerHTML+=" "}function processElements(){if(!documentReady)return;for(var a in pseudoCSSRules){debug(a+" cc:"+pseudoCSSRules[a]["column-count"]+" cw:"+pseudoCSSRules[a]["column-width"]+" cr:"+pseudoCSSRules[a]["column-rule"]+" cg:"+pseudoCSSRules[a]["column-gap"]);var b=ut.cssQuery(a);for(var c=0;c<b.length;c++){processElement(b[c],pseudoCSSRules[a]["column-count"],pseudoCSSRules[a]["column-width"],pseudoCSSRules[a]["column-gap"],pseudoCSSRules[a]["column-rule"])}}}function parseStylesheet(a){var b=new ut.getPseudoCssRules("column-count",a);for(var c=0;b&&c<b.cssRules.length;c++){if(!pseudoCSSRules[b.cssRules[c].selectorText])pseudoCSSRules[b.cssRules[c].selectorText]=new Object;pseudoCSSRules[b.cssRules[c].selectorText]["column-count"]=b.cssRules[c].value}b=new ut.getPseudoCssRules("column-width",a);for(var c=0;b&&c<b.cssRules.length;c++){if(!pseudoCSSRules[b.cssRules[c].selectorText])pseudoCSSRules[b.cssRules[c].selectorText]=new Object;pseudoCSSRules[b.cssRules[c].selectorText]["column-width"]=b.cssRules[c].value}b=new ut.getPseudoCssRules("column-gap",a);for(var c=0;b&&c<b.cssRules.length;c++){if(!pseudoCSSRules[b.cssRules[c].selectorText])pseudoCSSRules[b.cssRules[c].selectorText]=new Object;pseudoCSSRules[b.cssRules[c].selectorText]["column-gap"]=b.cssRules[c].value}b=new ut.getPseudoCssRules("column-rule",a);for(var c=0;b&&c<b.cssRules.length;c++){if(!pseudoCSSRules[b.cssRules[c].selectorText])pseudoCSSRules[b.cssRules[c].selectorText]=new Object;pseudoCSSRules[b.cssRules[c].selectorText]["column-rule"]=b.cssRules[c].value}}function parseStylesheets(){var a=true;for(var b in cssCache){if(cssCache[b]!=false)parseStylesheet(cssCache[b]);else a=false}if(a){processElements()}}function loadCssCache(s,callback){if(s.href&&s.cssText){cssCache[s.href]=s.cssText;eval(callback)()}if(s.href&&typeof XMLHttpRequest!="undefined"){var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(typeof xmlhttp.status=="undefined"||xmlhttp.status==200||xmlhttp.status==304){cssCache[s.href]=xmlhttp.responseText;eval(callback)()}}};xmlhttp.open("GET",s.href,true);xmlhttp.send(null)}}function loadStylesheets(){if(document.styleSheets){for(var a=0;a<document.styleSheets.length;a++){cssCache[document.styleSheets[a].href]=false}for(var a=0;a<document.styleSheets.length;a++){loadCssCache(document.styleSheets[a],"parseStylesheets")}}else if(document.getElementsByTagName){var b=document.getElementsByTagName("link");for(var a=0;a<b.length;a++){cssCache[b[a].href]=false}for(var a=0;a<b.length;a++){loadCssCache(b[a],"parseStylesheets")}}}var cssCache=new Object;var splitableTags=new Array("P","DIV","SPAN","BLOCKQUOTE","ADDRESS","PRE","A","EM","I","STRONG","B","CITE","OL","UL","LI");var pseudoCSSRules=new Object;var ut=new CSS3Utility;var debug=ut.debug;if(document.location.search.match("mode=debug"))var isDebug=true;else var isDebug=false;var bestSplitPoint=null;var secondSplitPoint=null;var secondSplitBottom=0;var documentReady=false;ut.XBrowserAddEventHandler(window,"load",function(){documentReady=true;processElements()});loadStylesheets()}CSS3Utility.prototype.cssQuery=function(){function G(a,b){a[a.length]=b}function F(a){return Boolean(a.nodeType==i&&a.tagName!="!")}function E(a){while((a=a.nextSibling)&&!F(a))continue;return a}function D(a){while((a=a.previousSibling)&&!F(a))continue;return a}function C(a,b){return a[B]==b}function A(a,b,c){if(c&&!C(a,c))return false;return b=="*"?F(a):m?a.tagName==b:a.tagName==b.toUpperCase()}function y(a,b,c){var e="";if(d.test(c)){c=c.split("|");e=c[0];c=c[1]}var f=[],g;switch(b){case" ":for(g in a){if(typeof a[g]=="function")continue;var h=z(a[g],c,e);for(var i=0;i<h.length;i++){if(F(h[i])&&(!e||C(h[i],e)))G(f,h[i])}}break;case">":for(g in a){var h=a[g].childNodes;for(var i=0;i<h.length;i++)if(A(h[i],c,e))G(f,h[i])}break;case"+":for(g in a){var j=E(a[g]);if(j&&A(j,c,e))G(f,j)}break;case"~":for(g in a){var j=a[g];while(j=E(j)){if(j&&A(j,c,e))G(f,j)}}break;case".":c=new RegExp("(^|\\s)"+c+"(\\s|$)");for(g in a)if(c.test(a[g].className))G(f,a[g]);break;case"#":for(g in a)if(a[g].id==c)G(f,a[g]);break;case"@":c=w[c];for(g in a)if(c(a[g]))G(f,a[g]);break;case":":c=s[c];for(g in a)if(c(a[g]))G(f,a[g]);break}return f}function x(a,b,c){this.id=w.length;var d="element.";switch(a.toLowerCase()){case"id":d+="id";break;case"class":d+="className";break;default:d+="getAttribute('"+a+"')"}switch(b){case"=":d+="=="+u(c);break;case"~=":d="/(^|\\s)"+v(c)+"(\\s|$)/.test("+d+")";break;case"|=":d="/(^|-)"+v(c)+"(-|$)/.test("+d+")";break}G(w,new Function("element","return "+d))}function v(a){return t.test(a)?a.slice(1,-1):a}function u(a){return t.test(a)?a:"'"+a+"'"}function r(a){if(b.test(a))a=" "+a;return a.match(c)||[]}function q(a){return a.replace(g,h).replace(x.ALL,x.ID).replace(e,f)}function o(a,b){if(!a)return[];var c=arguments.callee.caching&&!b;b=b?b.constructor==Array?b:[b]:[document];m=false;var d=q(a).split(",");var e=[];for(var f in d){a=r(d[f]);var g=0,h,i,j="",k=b;while(g<a.length){h=a[g++];i=a[g++];j+=h+i;k=c&&n[j]?n[j]:y(k,h,i);if(c)n[j]=k}e=e.concat(k)}return e}var a="1.0.1";var b=/^[^>\+~\s]/;var c=/[\s>\+~:@#\.]|[^\s>\+~:@#\.]+/g;var d=/\|/;var e=/([\s>\+~\,]|^)([\.:#@])/g;var f="$1*$2";var g=/^\s+|\s*([\+\,>\s;:])\s*|\s+$/g;var h="$1";var i=1;var j=3;var k=9;var l=/MSIE/.test(navigator.appVersion),m;var n={};o.caching=false;o.reset=function(){n={}};o.toString=function(){return"function cssQuery() {\n  [version "+a+"]\n}"};var p=l?function(a){if(a.nodeType!=k)a=a.document;return a.mimeType=="XML Document"}:function(a){if(a.nodeType==k)a=a.documentElement;return a.localName!="HTML"};var s={link:function(a){for(var b=0;b<document.links;b++){if(document.links[b]==a)return true}},visited:function(a){},"first-child":function(a){return!D(a)},"last-child":function(a){return!E(a)},root:function(a){var b=a.ownerDocument||a.document;return Boolean(a==b.documentElement)},empty:function(a){for(var b=0;b<a.childNodes.length;b++){if(F(a.childNodes[b])||a.childNodes[b].nodeType==j)return false}return true}};var t=/([\'\"])[^\1]*\1/;var w=[];x.prototype.toString=function(){return x.PREFIX+this.id};x.PREFIX="@";x.ALL=/\[([^~|=\]]+)([~|]?=?)([^\]]+)?\]/g;x.ID=function(a,b,c,d){return new x(b,c,d)};var z=l?function(a,b){return b=="*"&&a.all?a.all:a.getElementsByTagName(b)}:function(a,b,c){return c?a.getElementsByTagNameNS("*",b):a.getElementsByTagName(b)};var B=l?"scopeName":"prefix";if("i".replace(/i/,function(){return""})){var H=String.prototype.replace;var I=function(a,b){var c,d="",e=this;while(c=a.exec(e)){d+=e.slice(0,c.index)+b(c[0],c[1],c[2],c[3],c[4]);e=e.slice(c.lastIndex)}return d+e};String.prototype.replace=function(a,b){this.replace=typeof b=="function"?I:H;return this.replace(a,b)}}return o}();CSS3Utility.prototype.XBrowserAddEventHandler=function(target,eventName,handlerName){if(!target)return;if(target.addEventListener){target.addEventListener(eventName,function(e){eval(handlerName)(e)},false)}else if(target.attachEvent){target.attachEvent("on"+eventName,function(e){eval(handlerName)(e)})}else{var originalHandler=target["on"+eventName];if(originalHandler){target["on"+eventName]=function(e){originalHandler(e);eval(handlerName)(e)}}else{target["on"+eventName]=eval(handlerName)}}var l=this.handlerList.length;this.handlerList[l]=new Array(2);this.handlerList[l][0]=target.id;this.handlerList[l][1]=eventName};CSS3Utility.prototype.getPseudoCssRules=function(a,b){this.cssRules=new Array;var c=a.replace("-","-")+"[\\s]*:[\\s]*([^;}]*)[;}]";var d="$";var e=new RegExp(c,"g");var f=e.exec(b);var g=0;while(f){var h=b.substr(0,b.substr(0,b.indexOf(f[0])).lastIndexOf("{"));var i=h.substr(h.lastIndexOf("}")+1).replace(/^\s*|\s*$/g,"");this.cssRules[g]=new Object;this.cssRules[g].selectorText=i;this.cssRules[g].property=a;this.cssRules[g].value=f[1].replace(/(\r?\n)*/g,"");g++;f=e.exec(b)}};CSS3Utility.prototype.randomId=function(){var a="";for(var b=0;b<6;b++)a+=String.fromCharCode(97+Math.floor(Math.random()*24));return a};CSS3Utility.prototype.debug=function(a){var b=document.getElementById("debugOutput");if(typeof b!="undefined"&&b){b.innerHTML+=a}};var css3MC=new CSS3MultiColumn})()